# Fly.io config for Valet Worker
# Deploy with: fly deploy --config fly/worker.toml --app <app-name>
# App names: valet-worker-dev | valet-worker-stg | valet-worker

primary_region = "iad"
kill_signal = "SIGTERM"
kill_timeout = 60

[build]
  dockerfile = "apps/worker/Dockerfile"

[env]
  NODE_ENV = "production"

# Worker has no HTTP service - it connects to Hatchet via gRPC
# Use a process group instead
[processes]
  worker = "node apps/worker/dist/main.js"

# No auto-stop for workers - they need to stay running to poll for tasks
[[vm]]
  memory = "1gb"
  cpu_kind = "shared"
  cpus = 1
  processes = ["worker"]

# ===========================================================================
# WeKruit Valet - Environment Variables
# ===========================================================================
# Copy this file to .env and fill in the values.
#   cp .env.example .env
#
# Required variables are marked with [REQUIRED].
#
# ─── Multi-Environment Setup ───
# Local:  .env (this file, gitignored)
# Dev:    fly secrets -a valet-api-dev
# Stg:    fly secrets -a valet-api-stg
# Prod:   fly secrets -a valet-api
#
# Google OAuth callback URLs per environment:
#   Local: http://localhost:8000/api/v1/auth/google/callback
#   Dev:   https://valet-api-dev.fly.dev/api/v1/auth/google/callback
#   Stg:   https://valet-api-stg.fly.dev/api/v1/auth/google/callback
#   Prod:  https://valet-api.fly.dev/api/v1/auth/google/callback
#
# Add ALL callback URLs to Google Cloud Console → Credentials → OAuth 2.0
# ===========================================================================

# ─── General ───
NODE_ENV=development
PORT=8000

# ─── PostgreSQL (Supabase) ───
# [REQUIRED] Transaction pooler for app runtime (port 6543, uses pgbouncer)
# Supabase Dashboard → Settings → Database → Connection string → URI
DATABASE_URL=postgresql://postgres.[project-ref]:[password]@aws-1-us-east-1.pooler.supabase.com:6543/postgres?pgbouncer=true&connection_limit=5
# [REQUIRED] Session pooler for migrations/DDL (port 5432, IPv4-compatible)
# Supabase Dashboard → Connect → Session pooler
# Note: Direct connection (db.[ref].supabase.co) is IPv6-only; use session pooler on IPv4 networks
DATABASE_DIRECT_URL=postgresql://postgres.[project-ref]:[password]@aws-1-us-east-1.pooler.supabase.com:5432/postgres

# ─── Redis (Upstash) ───
# [REQUIRED] Upstash Redis URL (use rediss:// for TLS)
# Upstash Console → Redis → Details → Endpoint
REDIS_URL=rediss://default:[password]@[endpoint].upstash.io:6379

# ─── Authentication ───
# [REQUIRED] Google OAuth 2.0 credentials
# Google Cloud Console → APIs & Services → Credentials → OAuth 2.0 Client IDs
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret
GOOGLE_CALLBACK_URL=http://localhost:8000/api/v1/auth/google/callback

# [REQUIRED] JWT signing secrets (generate with: openssl rand -base64 48)
JWT_SECRET=change-me-to-a-random-string-at-least-32-chars
JWT_REFRESH_SECRET=change-me-to-another-random-string-at-least-32-chars

# ─── RabbitMQ (CloudAMQP) ───
# [REQUIRED] Used for task queue messaging
# CloudAMQP Dashboard → Instance → AMQP URL
# Free tier: Little Lemur (1M messages/month, 20 connections)
RABBITMQ_URL=amqps://user:password@host.lmq.cloudamqp.com/vhost

# ─── Object Storage (Supabase Storage S3) ───
# [REQUIRED] Supabase Storage with S3 protocol
# Supabase Dashboard → Storage → S3 Connection → Create access keys
# Docs: https://supabase.com/docs/guides/storage/s3/authentication
S3_ENDPOINT=https://[project-ref].storage.supabase.co/storage/v1/s3
S3_ACCESS_KEY=your-s3-access-key-id
S3_SECRET_KEY=your-s3-secret-access-key
S3_REGION=us-east-1
S3_BUCKET_RESUMES=resumes
S3_BUCKET_SCREENSHOTS=screenshots
S3_BUCKET_ARTIFACTS=artifacts

# ─── LLM Providers ───
# [REQUIRED] At least one LLM provider API key
ANTHROPIC_API_KEY=sk-ant-your-anthropic-key
OPENAI_API_KEY=sk-your-openai-key

# LLM budget limits (optional)
LLM_MONTHLY_BUDGET_USD=50
LLM_PER_TASK_BUDGET_USD=0.50

# ─── Stripe (Billing) ───
# [REQUIRED for billing] Stripe API keys
# Stripe Dashboard → Developers → API keys
STRIPE_SECRET_KEY=sk_test_your-stripe-secret-key
STRIPE_PUBLISHABLE_KEY=pk_test_your-stripe-publishable-key
# Stripe Dashboard → Developers → Webhooks → Add endpoint → Signing secret
STRIPE_WEBHOOK_SECRET=whsec_your-stripe-webhook-secret

# ─── GhostHands (Browser Automation) ───
# [REQUIRED for task execution] GhostHands API for browser automation
# Runs on EC2 worker instances, default port 3100
GHOSTHANDS_API_URL=http://localhost:3100
# Service-to-service auth key (set in GhostHands deployment config)
GH_SERVICE_SECRET=your-ghosthands-service-secret
# Deploy auth key — must match GH_DEPLOY_SECRET on EC2 deploy-server
GH_DEPLOY_SECRET=your-ghosthands-deploy-secret

# ─── Frontend ───
# Vite env vars (must start with VITE_)
# In production these are injected at Docker build time via --build-arg
VITE_API_URL=http://localhost:8000
VITE_WS_URL=ws://localhost:8000/api/v1/ws
VITE_GOOGLE_CLIENT_ID=your-google-client-id
VITE_STRIPE_PUBLISHABLE_KEY=pk_test_your-stripe-publishable-key

# ─── Kasm Workspaces ───
# [REQUIRED for Kasm sandboxes] Kasm Workspaces API credentials
# Kasm Admin Panel → API Keys
KASM_API_URL=
KASM_API_KEY=
KASM_API_KEY_SECRET=

# ─── Auto-scaling (disabled by default) ───
AUTOSCALE_ENABLED=false
AUTOSCALE_MIN_INSTANCES=1
AUTOSCALE_MAX_INSTANCES=5
AUTOSCALE_CHECK_INTERVAL_MS=30000
AUTOSCALE_COOLDOWN_MS=120000
AUTOSCALE_ENVIRONMENT=prod

# ─── AWS (EC2 Sandbox Management) ───
# [REQUIRED for sandbox start/stop] AWS credentials with EC2 permissions
# IAM Console → Users → Create user → Attach EC2FullAccess policy
AWS_ACCESS_KEY_ID=your-aws-access-key-id
AWS_SECRET_ACCESS_KEY=your-aws-secret-access-key
AWS_REGION=us-east-1

# ─── CORS ───
CORS_ORIGIN=http://localhost:5173

# ─── Email (Resend) ───
# Sign up at https://resend.com — free tier: 100 emails/day
# Dashboard → API Keys → Create API Key
RESEND_API_KEY=re_your_resend_api_key

# ─── Monitoring (optional) ───
# Sentry DSN for backend (API + Worker)
SENTRY_DSN=
# Sentry DSN for frontend (Vite env var)
VITE_SENTRY_DSN=
BETTER_STACK_SOURCE_TOKEN=

# ─── Turborepo Remote Cache (optional) ───
TURBO_TOKEN=
TURBO_TEAM=

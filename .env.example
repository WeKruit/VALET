# ===========================================================================
# WeKruit Valet - Environment Variables
# ===========================================================================
# Copy this file to .env and fill in the values.
#   cp .env.example .env
#
# Required variables are marked with [REQUIRED].
#
# ─── Multi-Environment Setup ───
# Local:  .env (this file, gitignored)
# Dev:    fly secrets -a valet-api-dev
# Stg:    fly secrets -a valet-api-stg
# Prod:   fly secrets -a valet-api
#
# Google OAuth callback URLs per environment:
#   Local: http://localhost:8000/api/v1/auth/google/callback
#   Dev:   https://valet-api-dev.fly.dev/api/v1/auth/google/callback
#   Stg:   https://valet-api-stg.fly.dev/api/v1/auth/google/callback
#   Prod:  https://valet-api.fly.dev/api/v1/auth/google/callback
#
# Add ALL callback URLs to Google Cloud Console → Credentials → OAuth 2.0
# ===========================================================================

# ─── General ───
NODE_ENV=development
PORT=8000

# ─── PostgreSQL (Supabase) ───
# [REQUIRED] Transaction pooler for app runtime (port 6543, uses pgbouncer)
# Supabase Dashboard → Settings → Database → Connection string → URI
DATABASE_URL=postgresql://postgres.[project-ref]:[password]@aws-1-us-east-1.pooler.supabase.com:6543/postgres?pgbouncer=true&connection_limit=5
# [REQUIRED] Session pooler for migrations/DDL (port 5432, IPv4-compatible)
# Supabase Dashboard → Connect → Session pooler
# Note: Direct connection (db.[ref].supabase.co) is IPv6-only; use session pooler on IPv4 networks
DATABASE_DIRECT_URL=postgresql://postgres.[project-ref]:[password]@aws-1-us-east-1.pooler.supabase.com:5432/postgres

# ─── Redis (Upstash) ───
# [REQUIRED] Upstash Redis URL (use rediss:// for TLS)
# Upstash Console → Redis → Details → Endpoint
REDIS_URL=rediss://default:[password]@[endpoint].upstash.io:6379

# ─── Authentication ───
# [REQUIRED] Google OAuth 2.0 credentials
# Google Cloud Console → APIs & Services → Credentials → OAuth 2.0 Client IDs
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret
GOOGLE_CALLBACK_URL=http://localhost:8000/api/v1/auth/google/callback

# [REQUIRED] JWT signing secrets (generate with: openssl rand -base64 48)
JWT_SECRET=change-me-to-a-random-string-at-least-32-chars
JWT_REFRESH_SECRET=change-me-to-another-random-string-at-least-32-chars

# ─── RabbitMQ (CloudAMQP) ───
# [REQUIRED] Used by Hatchet for task queue messaging
# CloudAMQP Dashboard → Instance → AMQP URL
# Free tier: Little Lemur (1M messages/month, 20 connections)
RABBITMQ_URL=amqps://user:password@host.lmq.cloudamqp.com/vhost

# ─── Hatchet (Workflow Orchestration) ───
# [REQUIRED] Token for Hatchet TypeScript SDK
# Get from Hatchet dashboard → Settings → API Tokens
# Dev:  https://valet-hatchet-dev.fly.dev
# Stg:  https://valet-hatchet-stg.fly.dev
# Prod: https://valet-hatchet.fly.dev
HATCHET_CLIENT_TOKEN=your-hatchet-client-token
# TLS strategy: "tls" for Fly-hosted (Fly terminates TLS on port 443), "none" only for local Hatchet
HATCHET_CLIENT_TLS_STRATEGY=tls
# TLS server name for gRPC SNI (must match Fly.io app hostname)
HATCHET_CLIENT_TLS_SERVER_NAME=valet-hatchet-dev.fly.dev
# gRPC host:port — port 443 via Fly's http_service with h2_backend (falls back to JWT if unset)
HATCHET_CLIENT_HOST_PORT=valet-hatchet-dev.fly.dev:443
# Hatchet REST API URL (dashboard on port 8443)
HATCHET_CLIENT_API_URL=https://valet-hatchet-dev.fly.dev:8443

# ─── Object Storage (Supabase Storage S3) ───
# [REQUIRED] Supabase Storage with S3 protocol
# Supabase Dashboard → Storage → S3 Connection → Create access keys
# Docs: https://supabase.com/docs/guides/storage/s3/authentication
S3_ENDPOINT=https://[project-ref].storage.supabase.co/storage/v1/s3
S3_ACCESS_KEY=your-s3-access-key-id
S3_SECRET_KEY=your-s3-secret-access-key
S3_REGION=us-east-1
S3_BUCKET_RESUMES=resumes
S3_BUCKET_SCREENSHOTS=screenshots
S3_BUCKET_ARTIFACTS=artifacts

# ─── LLM Providers ───
# [REQUIRED] At least one LLM provider API key
ANTHROPIC_API_KEY=sk-ant-your-anthropic-key
OPENAI_API_KEY=sk-your-openai-key

# LLM budget limits (optional)
LLM_MONTHLY_BUDGET_USD=50
LLM_PER_TASK_BUDGET_USD=0.50

# ─── Frontend ───
# Vite env vars (must start with VITE_)
# In production these are injected at Docker build time via --build-arg
VITE_API_URL=http://localhost:8000
VITE_WS_URL=ws://localhost:8000/api/v1/ws
VITE_GOOGLE_CLIENT_ID=your-google-client-id

# ─── CORS ───
CORS_ORIGIN=http://localhost:5173

# ─── Monitoring (optional) ───
SENTRY_DSN=
BETTER_STACK_SOURCE_TOKEN=

# ─── Turborepo Remote Cache (optional) ───
TURBO_TOKEN=
TURBO_TEAM=
